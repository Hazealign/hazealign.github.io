<!doctype html>
<html amp lang="en">
  <head>
    <meta charset="utf-8">
    <title>지킬 블로그에 AMP를 적용해보자</title>
    <link rel="canonical" href="http://realignist.me/code/2016/12/01/amp-my-jekyll-web.html" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-custom>.radius-half {
  border-radius: 50%; }

.site-header {
  position: relative;
  width: 100%;
  max-width: 700px;
  margin: 16px auto 0 auto;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box; }
  .site-header .page-links {
    display: block;
    position: absolute;
    top: 10px;
    right: 16px;
    font-weight: 200;
    font-style: normal;
    font-size: 18px;
    line-height: 30px; }
    .site-header .page-links a {
      text-decoration: none;
      color: #999999; }
      .site-header .page-links a:hover {
        color: #333333; }

code {
  word-break: break-all;
  white-space: pre-wrap; }

body {
  padding: 5%;
  max-width: 700px; }

h1 {
  font-size: 1.7em; }

h2 {
  font-size: 1.35em; }

h5 {
  text-align: center;
  padding-top: 10%; }
</style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <header class="site-header">
      <a href="/" class="logo"><span class="logo"><amp-img src="/assets/images/pikachu_logo.png" width="48" height="48" class="radius-half" /></span></a>
      <div class="page-links">
        <a class="page-link" href="/">Home</a> • <a class="page-link" href="/about/">About</a>
      </div>
    </header>
    <h1 class="post-title">
      지킬 블로그에 AMP를 적용해보자
    </h1>
    <span>2016년 12월 01일 작성 - Haze Lee.</span>
    <p>항상 그렇지만 사람이 백수가 되면 심심해지고, 사람이 잉여로워지면 무언가 재미난 것을 하게 된다. 오늘은 지킬 블로그에 AMP(Accelerated Mobile Pages) 페이지를 넣은 후기를 쓰려고 한다. 이 글은 AMP가 무엇인지 아는 사람을 위해 작성된 글로, AMP에 대한 설명과 소개는 <a href="https://www.ampproject.org/ko/learn/about-amp/">여기</a>에서 볼 수 있다.</p>

<h3 id="travis">천리길도 Travis부터.</h3>

<p>사실 지금 보고 있는 이 웹 페이지는 GitHub Pages에서 돌아가고 있다. GitHub Pages는 기본적으로 Jekyll을 지원하기 때문에 소스 코드만 GitHub에 올리면, 알아서 웹에서 생성된 html 파일을 볼 수 있다. 하지만 GitHub Pages는 외부 플러그인을 지원하지 않는 안전 모드로 동작하기 때문에, 나는 AMP를 적용하기 위해 html만이 있는 브랜치와 소스 코드가 있는 브랜치를 분리하게 되었다.</p>

<p>item4님도 Travis로 블로그를 설정하셨길래 어떻게 셋팅했나 보니까 Lektor는 손쉽게 GitHub로 생성된 html만을 Deploy할 수 있었다. 아…! 셋팅하기 너무 귀찮았지만, 백수니까 그냥 셋팅했다. 내 빌드 스크립트는 <a href="https://github.com/Hazealign/hazealign.github.io/blob/src/scripts/deploy.sh">여기</a>에서 볼 수 있다. (블로그 커밋 로그가 엉망이니까 로그는 보지 않는걸 권장한다…)</p>

<h4 id="section">참고했었던 스크립트들이다.</h4>

<ul>
<li><a href="https://gist.github.com/domenic/ec8b0fc8ab45f39403dd">처음에 뼈대로 쓴 것</a></li>
  <li><a href="http://eshepelyuk.github.io/2014/10/28/automate-github-pages-travisci.html">그 이후에 참고한 것 </a></li>
</ul><p>아, 기분 좋게 Travis가 연동됬다. 이제 Jekyll에 플러그인을 이것저것 넣을 수도 있으니 AMP 플러그인을 넣어보기로 한다.</p>

<h3 id="amp-jekyll-amplify">amp-jekyll과 amplify</h3>

<p>amp-jekyll과 amplify를 소개하기 전에 우선 고백한다. 내 블로그는 끄-음찍한 혼종이다. 상단 부분의 헤더는 amplify를 참고했고, 기본적으로 amp html을 생성하는 것은 amp-jekyll을 이용하고 있다. 내가 웹을 제대로 개발하는 사람은 아니기 때문에 내 블로그는 그만 알아보자…</p>

<p><a href="https://github.com/juusaw/amp-jekyll">amp-jekyll</a>은 jekyll 플러그인 형태로 amp html을 생성시키는 프로젝트다. 또 <a href="https://github.com/ageitgey/amplify">amplify</a>는 amp html을 만들어내는 하나의 jekyll 테마이다. 나는 이미 만들어두고 쓰고 있는 베이스 jekyll 테마가 있었기 때문에 amp html에서만 amplify를 살짝 참고하고, amp html 베이스는 amp-jekyll로 만들었다. amp-jekyll을 약간 수정했는데 내 프로젝트의 <code>_posts</code> 구조에 맞게 바꾼 것과 <a href="https://github.com/juusaw/amp-jekyll/pull/14/files">Pull Request 하나</a>를 체리픽한게 끝이다.</p>

<h3 id="section-1">하면서 디버깅은 어떻게 했는가.</h3>

<p>다른 amp html을 개발할 때랑 똑같이 amp 페이지 url 뒤에 <code>#development=1</code>를 넣어주면 된다. 매우 심플하다. 그러면 amp validation이 동작할 것이다.</p>

<p>또, 중간에 <a href="https://github.com/juusaw/amp-jekyll/pull/11">이 PR</a>을 체리픽 했었는데 문제가 있었다. <code>amp-img</code> 태그에는 기본적으로 이미지의 width와 height가 명시되어야하기 때문에 fastimage라는 모듈을 써서 이미지의 원본 사이즈를 가져오는데, 여기가 제대로 동작하지 않았었다. 한가지 더, amp html은 url 맨 끝에 <code>.html</code> 확장자를 붙으면 에러가 난다. 참고하자.</p>

<h3 id="amp---">그래서 내 AMP 페이지는 어떻게 보일까?</h3>

<p><amp-img src="/assets/images/20161201_1.png" alt="스크린샷" layout="responsive"></amp-img></p>

<p>대충 이렇게 보인다. 디자인적으로는 아쉽긴 하지만, 모바일에서 검색했을 때 빨리 보인다는 메리트 때문에 AMP를 쓰는거라서 크게 거슬리거나 하지는 않았다. 이제 구글 검색이 AMP 검색 결과를 보여주길 기다리면… 될 것 같다. :D</p>
    <h5> <!-- footer start -->

<footer class="site-footer"><a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> Subscribe!</span></a>
    <div class="inner">
         <section class="copyright">All content copyright <a href="mailto:hazelee@re.aligni.st">Haze Lee</a> © 2016 • All rights reserved.</section><section class="poweredby">For Geeky Tomorrow.</section>
</div>
</footer><!-- footer end --></h5>
  </body>
</html>